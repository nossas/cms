{% extends "eleicao/base.html" %}
{% load static %}

{% block extra_head %}
<script src="https://code.jquery.com/jquery-3.7.0.min.js"
  integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
<!-- Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
{% endblock %}

{% block navbar %}{% endblock %}
{% block content %}
<main class="h-screen">
  <div class="grid grid-cols-1 gap-10 p-5 w-full h-full md:grid-cols-2 md:pl-10 md:p-0">
    <section class="pb-20 candidate-form">
      <div class="py-4 ml-16 candidate-logo">
        <a href="#">
          <img src="{% static 'images/eleicao/logo-eleicao-do-ano.svg' %}" alt="Logo Eleição do Ano">
        </a>
      </div>
      <div class="flex flex-col justify-center items-center px-4 candidate-content">
        <ul class="steps steps-horizontal">
          {% for step in wizard.steps.all %}
            {% if step == wizard.steps.current %}
              <li class="step step-primary">{{step1}}</li>
            {% else %}
              <li class="step">{{step1}}</li>
            {% endif %}
          {% endfor %}
        </ul>
        <div class="w-full md:max-w-[450px]">
          {% if wizard.form.forms %}
          <h1 class="text-7xl text-[#1842AC] pt-10 ">{{wizard.form.forms.title}}</h1>
          {% else %}
          <h1 class="text-7xl text-[#1842AC] pt-10 ">{{wizard.form.title}}</h1>
          {% endif %}
          <form class="candidate-create-form" action="" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-items">
              {{ wizard.management_form }}
              {% if wizard.form.forms %}
                {{ wizard.form.management_form }}
                  {% for form in wizard.form.forms %}
                    {% for field in form %}
                      {{field.label_tag}}
                      {{field}}
                    {% endfor %}
                  {% endfor %}
              {% else %}
              {% for field in wizard.form %}
                <div class="py-1 w-full form-control">
                  
                  {% if field.name == "slug" %}
                    {{field.label_tag}}
                    <div class="flex items-center gap-3 font-bold ">
                    <p>aeleicaodoano.org/</p>
                    <p>{{field}}</p>
                  </div>
                  {% elif "social_media" in field.name %}
                  <div class="flex gap-4">
                    {% if field.name == "social_media" %}
                    <div>
                    <div class="max-w-xs">
                      {{field.label_tag}}
                      {{field}}
                    {% endif %}
                    {% if field.name == "social_media_2" %}
                      <div class=" gap-1 font-bold max-w-xs">
                        {{field.label_tag}}
                        {{field}}
                      </div>
                    </div>
                    </div>
                    {% endif %}
                  </div>
                <div class="py-1 form-control">
                  {% elif "agree" in field.name %}
                      {% comment %} TODO: Fazer esse trecho como include {% endcomment %}
                      <div class="flex flex-col gap-3 commitment">
                        <div class="commitment-tooltip tooltip tooltip-bottom before:z-20 tooltip-error" data-tip="Você deve marcar essa opção">
                          <label id="commitment-checkbox">
                              {{ field }}
                              <div class="max-h-[96px] overflow-hidden !items-start !justify-center flex !p-4 rounded border bg-neutral-100 border-neutral-200 commitment-box">
                                <picture class="pr-4 icon-svg">
                                  {% with icon_path="./icons/"|add:field.field.widget.icon|add:".svg" %}
                                    {% include icon_path %}
                                  {% endwith %}
                                </picture>
                                <div class="font-normal text-neutral-600">
                                  {{ field.field.widget.text }}
                                </div>
                              </div>
                          </label>
                        </div>
                      </div>
                  {% else %}
                    {{field.label_tag}}
                    {{field}}
                  {% endif %}
                </div>
              {% endfor %}
            {% endif %}
            </div>
            <div class="flex justify-between items-center py-4">
              {% if wizard.steps.prev %}
                <button class="text-xl form-back-btn" type="submit" formnovalidate name="wizard_goto_step" value="{{ wizard.steps.prev }}">Voltar</button>
              {% else %}
                <a href="#" class="text-xl form-back-btn">Voltar</a>
              {% endif %}
                <input id="submit-btn" class="btn btn-primary" type="submit" value="Continuar" />
              </div>
          </form>
        </div>
      </div>
    </section>
    <img class="hidden object-cover md:block md:w-full md:h-full" src="{% static 'images/eleicao/candidate-form-image.png' %}" alt="Imagem">
  </div>
</main>
{% endblock %}

{% block footer_js %}
<script>
  (function ($) {
    "use strict";

    $(function () {
      $('#id_4-state').select2({
        placeholder: 'Selecione seu estado'
      });
      $('#id_4-city').select2({
        placeholder: 'Selecione sua cidade'
      });
      $('#id_4-neighborhood').select2({
        placeholder: 'Selecione seu bairro'
      });
      $('#id_4-zone_id').select2({
        placeholder: 'Selecione o local da candidatura'
      });

      var uf;
      $("#id_4-state").on("change", (evt) => {
        uf = evt.target.value

        $.get("{% url 'eleicao:cep' %}" + "?state=" + uf, (data) => {
          $("#id_4-city").empty()
          $("#id_4-city").append('<option value="">----</option>')
          $.each(data.choices, (index, value) => {
            $("#id_4-city").append(
              '<option value="' + value[0] + '">' + value[1] + '</option>'
            )
          })
        })
      });

      var city
      $("#id_4-city").on("change", (evt) => {
        city = evt.target.value;
        $.get("{% url 'eleicao:cep' %}" + "?city=" + city + "&state=" + uf, (data) => {
          $("#id_4-neighborhood").empty()
          $("#id_4-neighborhood").append('<option value="">----</option>')
          $.each(data.choices, (index, value) => {
            $("#id_4-neighborhood").append('<option value="' + value[0] + '">' + value[1] + "</option>")
          })
        })
      });

      $("#id_4-neighborhood").on("change", (evt) => {
        $.get("{% url 'eleicao:cep' %}" + "?city=" + city + "&state=" + uf + "&neighborhood=" + evt.target.value, (data) => {
          $("#id_4-zone_id").empty()
          $("#id_4-zone_id").append('<option value="">----</option>')
          $.each(data.choices, (index, value) => {
            $("#id_4-zone_id").append('<option value="' + value[0] + '">' + value[1] + "</option>")
          })
        })
      });
      
      //fill up slug
      $("#id_2-name").on("change",(evt) => {
        
        $.get("{% url 'eleicao:slug' %}" + "?name=" + evt.target.value, (data) => {
          $("#id_2-slug").val(data.slug)
         })
          
      } )
    });

    $(function () {
      let checkboxes = $("#commitment-checkbox input[type='checkbox']");
      let tooltips = $(".commitment-tooltip");

      checkboxes.on("change", function () {
        let checkbox = $(this);
        let isChecked = checkbox.prop("checked");
        let index = checkboxes.index(checkbox);

        // Find the corresponding tooltip by index
        let tooltip = tooltips.eq(index);

        if (isChecked) {
          tooltip.removeClass('tooltip-open');
        }
      });

      $("#submit-btn").on("click", function () {
        checkboxes.each(function () {
          let checkbox = $(this);
          let isChecked = checkbox.prop("checked");

          if (!isChecked) {
            let index = checkboxes.index(checkbox);
            let tooltip = tooltips.eq(index);
            tooltip.addClass('tooltip-open');
          }
        });
      });
    })
  }(window.jQuery));
</script>
<script src="{% static 'js/jquery-mask/jquery.mask.min.js' %}"></script>
{% endblock %}
