{% extends "votepeloclima/base.html" %}
{% load crispy_forms_filters %}

{% block content %}
<div class="container mx-auto py-5">
  <div class="d-flex justify-content-between">
    <div class="d-flex flex-column align-items-start" style="max-width:758px;">      
      <h1 class="fw-bold text-uppercase text-secondary">Olá, {{ request.user.first_name }}!</h1>
      <p>Gerencie suas informações de candidatura, edite seus dados e compartilhe seu perfil com os eleitores.</p>
      
      <!-- Status e Mensagem -->
      <div class="text-bg-light border rounded py-2 px-2" style="--bs-light-rgb:255,255,255;">
      <!-- BADGE -->
      <div class="badge text-bg-light text-uppercase d-flex align-items-center">
        <i class="bg-{% if flow.status == 'is_valid' %}secondary{% elif flow.status == 'submitted' %}warning{% else %}danger{% endif %} rounded-circle d-inline-block me-1" style="width:12px;height:12px;"></i>
        <span>{{ flow.get_status_display }}</span>
      </div>
      {% if flow.status == "draft" %}
        <div class="mt-2 px-2 d-flex flex-column align-items-end">
          <p>Seu cadastro está incompleto e seu perfil não está ativo. Por favor, complete as informações necessárias para ativar seu perfil e torná-lo visível aos eleitores. Clique em "Continuar Cadastro" para finalizar o cadastro.</p>
          <{% if checkout_is_valid %}a href="{% url 'register_step' step='checkout' %}"{% else %}button type="button" disabled{% endif %} class="btn btn-secondary">Submeter para análise</{% if checkout_is_valid %}a{% else %}button{% endif %}>
        </div>
      {% elif flow.status == "editing" %}
      <div class="mt-2 px-2 d-flex flex-column align-items-end">
        <p>Sua edição está incompleta e seu perfil está ativo. Você pode desativar seu perfil para que ele não fique público durante o processo de edição, se preferir.</p>
        <{% if checkout_is_valid %}a href="{% url 'register_step' step='checkout' %}"{% else %}button type="button" disabled{% endif %} class="btn btn-secondary">Submeter para análise</{% if checkout_is_valid %}a{% else %}button{% endif %}>
      </div>
      {% elif flow.status == "invalid" %}
      <div class="mt-2 px-2 d-flex flex-column">
        <p>{{ flow.invalid_reason }}</p>
      </div>
      {% elif flow.status == "submitted" %}
        <div class="mt-2 px-2">
          <p>Estamos verificando suas informações, este processo pode levar até 24 horas. Assim que a verificação for concluída te enviaremos um e-mail com o link do seu perfil.</p>
        </div>
      {% endif %}
      </div>

    </div>
    <div class="d-flex flex-column" style="--bs-gap:10px;width:245px;">
      {% if is_public %}
      <a class="btn btn-secondary" href="{% url 'candidate_profile' slug=flow.candidature.slug %}">Visualizar perfil</a>
      {% endif %}
      <a class="btn btn-secondary" href="#">Compartilhar seu perfil</a>
      {% if flow.status == "draft" or flow.status == "editing" %}
      <a class="btn btn-secondary" href="{% url 'register_step' step='checkout' %}">Editar informações</a>
      {% else %}
      <form method="post">
        {% csrf_token %}
        <input class="btn btn-secondary w-100" type="submit" name="request_change" value="Editar informações" />
      </form>
      {% endif %}
    </div>
  </div>
  <div class="accordion mt-4" id="accordionCheckoutSteps">
    {% for checkout_step in checkout_steps %}
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{forloop.counter}}" aria-expanded="false" aria-controls="collapse{{forloop.counter}}">
          {% if flow.status == "draft" %}<i class="bg-{% if checkout_step.is_valid %}success{% else %}danger{% endif %} rounded-circle d-inline-block me-2" style="width:10px;height:10px;"></i>{% endif %}{% if checkout_step.form.Meta.title %}{{checkout_step.form.Meta.title|upper}}{% else %}{{ checkout_step.name|upper }}{% endif %}
        </button>
      </h2>
      <div id="collapse{{forloop.counter}}" class="accordion-collapse collapse{% if flow.status == 'draft' %} show{% endif %}" data-bs-parent="#accordionCheckoutSteps">
        <div class="accordion-body">
          {% if checkout_step.form.helper %}
          {% crispy checkout_step.form checkout_step.form.helper %}
          {% else %}
          {% crispy checkout_step.form %}
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  <div class="mt-4" style="max-width:868px;">
    <h3 class="text-dark fw-bold text-uppercase">Outras informações</h3>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam lacinia iaculis arcu, sed ornare risus congue nec. Phasellus rhoncus, tortor in fermentum auctor, diam risus pulvinar nisi, ac ultrices nibh ipsum at lacus. Mauris varius metus in ante viverra faucibus. Vivamus fringilla metus urna, sit amet.</p>
    <div class="d-flex" style="--bs-gap:1.5rem;">
      <a href="#">Excluir cadastro</a>
      <a href="#">Contato</a>
      <a href="#">Saiba mais sobre a verificação de cadastro</a>
    </div>
  </div>
</div>
{% endblock %}
